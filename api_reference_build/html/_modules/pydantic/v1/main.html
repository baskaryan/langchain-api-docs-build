
<!DOCTYPE html>

<html data-content_root="../../../" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>pydantic.v1.main â€” ðŸ¦œðŸ”— LangChain  documentation</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet"/>
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css?v=a746c00c" rel="stylesheet" type="text/css"/>
<link href="../../../_static/autodoc_pydantic.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../../../_static/sphinx-design.min.css?v=95c83b7e" rel="stylesheet" type="text/css"/>
<link href="../../../_static/css/custom.css?v=b95e2228" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" rel="preload"/>
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" rel="preload"/>
<script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/documentation_options.js?v=3b5cce75"></script>
<script src="../../../_static/doctools.js?v=9a2dae69"></script>
<script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../../../_static/copybutton.js?v=f281be69"></script>
<script src="../../../_static/design-tabs.js?v=f930bc37"></script>
<script>DOCUMENTATION_OPTIONS.pagename = '_modules/pydantic/v1/main';</script>
<link href="../../../_static/favicon.png" rel="icon"/>
<link href="../../../search.html" rel="search" title="Search"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<meta content="Sep 23, 2024" name="docbuild:last-update"/>
</head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<div class="skip-link d-print-none" id="pst-skip-link"><a href="#main-content">Skip to main content</a></div>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>Back to top</button>
<input class="sidebar-toggle" id="pst-primary-sidebar-checkbox" type="checkbox"/>
<label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
<input class="sidebar-toggle" id="pst-secondary-sidebar-checkbox" type="checkbox"/>
<label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search" spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<div class="pst-async-banner-revealer d-none">
<aside aria-label="Version warning" class="d-none d-print-none" id="bd-header-version-warning"></aside>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
<button aria-label="Site navigation" class="pst-navbar-icon sidebar-toggle primary-toggle">
<span class="fa-solid fa-bars"></span>
</button>
<div class="navbar-header-items__start">
<div class="navbar-item">
<a class="navbar-brand logo" href="../../../index.html">
<img alt="ðŸ¦œðŸ”— LangChain  documentation - Home" class="logo__image only-light" src="../../../_static/wordmark-api.svg"/>
<script>document.write(`<img src="../../../_static/wordmark-api-dark.svg" class="logo__image only-dark" alt="ðŸ¦œðŸ”— LangChain  documentation - Home"/>`);</script>
</a></div>
</div>
<div class="navbar-header-items">
<div class="me-auto navbar-header-items__center">
<div class="navbar-item">
<nav>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../reference.html">
    Reference
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-external" href="https://api.python.langchain.com/">
    Legacy reference
  </a>
</li>
</ul>
</nav></div>
</div>
<div class="navbar-header-items__end">
<div class="navbar-item navbar-persistent--container">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search" spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</div>
<div class="navbar-item"><!-- This will display a link to LangChain docs -->
<head>
<style>
        .text-link {
            text-decoration: none; /* Remove underline */
            color: inherit;        /* Inherit color from parent element */
        }
    </style>
</head>
<body>
<a class="text-link" href="https://python.langchain.com/">Docs</a>
</body></div>
<div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
<div class="navbar-item"><ul aria-label="Quick Links" class="navbar-icon-links">
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/langchain-ai/langchain" rel="noopener" target="_blank" title="GitHub"><i aria-hidden="true" class="fa-brands fa-square-github fa-lg"></i>
<span class="sr-only">GitHub</span></a>
</li>
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/langchainai" rel="noopener" target="_blank" title="X / Twitter"><i aria-hidden="true" class="fab fa-twitter-square fa-lg"></i>
<span class="sr-only">X / Twitter</span></a>
</li>
</ul></div>
</div>
</div>
<div class="navbar-persistent--mobile">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search" spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</div>
</div>
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar hide-on-wide">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-item">
<nav>
<ul class="bd-navbar-elements navbar-nav">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../reference.html">
    Reference
  </a>
</li>
<li class="nav-item">
<a class="nav-link nav-external" href="https://api.python.langchain.com/">
    Legacy reference
  </a>
</li>
</ul>
</nav></div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-item"><!-- This will display a link to LangChain docs -->
<head>
<style>
        .text-link {
            text-decoration: none; /* Remove underline */
            color: inherit;        /* Inherit color from parent element */
        }
    </style>
</head>
<body>
<a class="text-link" href="https://python.langchain.com/">Docs</a>
</body></div>
<div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
<div class="navbar-item"><ul aria-label="Quick Links" class="navbar-icon-links">
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://github.com/langchain-ai/langchain" rel="noopener" target="_blank" title="GitHub"><i aria-hidden="true" class="fa-brands fa-square-github fa-lg"></i>
<span class="sr-only">GitHub</span></a>
</li>
<li class="nav-item">
<a class="nav-link pst-navbar-icon" data-bs-placement="bottom" data-bs-toggle="tooltip" href="https://twitter.com/langchainai" rel="noopener" target="_blank" title="X / Twitter"><i aria-hidden="true" class="fab fa-twitter-square fa-lg"></i>
<span class="sr-only">X / Twitter</span></a>
</li>
</ul></div>
</div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content" role="main">
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item">
<nav aria-label="Breadcrumb" class="d-print-none">
<ul class="bd-breadcrumbs">
<li class="breadcrumb-item breadcrumb-home">
<a aria-label="Home" class="nav-link" href="../../../index.html">
<i class="fa-solid fa-home"></i>
</a>
</li>
<li class="breadcrumb-item"><a class="nav-link" href="../../index.html">Module code</a></li>
<li aria-current="page" class="breadcrumb-item active">pydantic.v1.main</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<h1>Source code for pydantic.v1.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">prepare_class</span><span class="p">,</span> <span class="n">resolve_bases</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">AbstractSet</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">ClassVar</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
    <span class="n">no_type_check</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">dataclass_transform</span>

<span class="kn">from</span> <span class="nn">pydantic.v1.class_validators</span> <span class="kn">import</span> <span class="n">ValidatorGroup</span><span class="p">,</span> <span class="n">extract_root_validators</span><span class="p">,</span> <span class="n">extract_validators</span><span class="p">,</span> <span class="n">inherit_validators</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.config</span> <span class="kn">import</span> <span class="n">BaseConfig</span><span class="p">,</span> <span class="n">Extra</span><span class="p">,</span> <span class="n">inherit_config</span><span class="p">,</span> <span class="n">prepare_config</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.error_wrappers</span> <span class="kn">import</span> <span class="n">ErrorWrapper</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.errors</span> <span class="kn">import</span> <span class="n">ConfigError</span><span class="p">,</span> <span class="n">DictError</span><span class="p">,</span> <span class="n">ExtraError</span><span class="p">,</span> <span class="n">MissingError</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.fields</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MAPPING_LIKE_SHAPES</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">,</span>
    <span class="n">ModelField</span><span class="p">,</span>
    <span class="n">ModelPrivateAttr</span><span class="p">,</span>
    <span class="n">PrivateAttr</span><span class="p">,</span>
    <span class="n">Undefined</span><span class="p">,</span>
    <span class="n">is_finalvar_with_default_val</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.json</span> <span class="kn">import</span> <span class="n">custom_pydantic_encoder</span><span class="p">,</span> <span class="n">pydantic_encoder</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.parse</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">load_file</span><span class="p">,</span> <span class="n">load_str_bytes</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.schema</span> <span class="kn">import</span> <span class="n">default_ref_template</span><span class="p">,</span> <span class="n">model_schema</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.types</span> <span class="kn">import</span> <span class="n">PyObject</span><span class="p">,</span> <span class="n">StrBytes</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnyCallable</span><span class="p">,</span>
    <span class="n">get_args</span><span class="p">,</span>
    <span class="n">get_origin</span><span class="p">,</span>
    <span class="n">is_classvar</span><span class="p">,</span>
    <span class="n">is_namedtuple</span><span class="p">,</span>
    <span class="n">is_union</span><span class="p">,</span>
    <span class="n">resolve_annotations</span><span class="p">,</span>
    <span class="n">update_model_forward_refs</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.v1.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DUNDER_ATTRIBUTES</span><span class="p">,</span>
    <span class="n">ROOT_KEY</span><span class="p">,</span>
    <span class="n">ClassAttribute</span><span class="p">,</span>
    <span class="n">GetterDict</span><span class="p">,</span>
    <span class="n">Representation</span><span class="p">,</span>
    <span class="n">ValueItems</span><span class="p">,</span>
    <span class="n">generate_model_signature</span><span class="p">,</span>
    <span class="n">is_valid_field</span><span class="p">,</span>
    <span class="n">is_valid_private_name</span><span class="p">,</span>
    <span class="n">lenient_issubclass</span><span class="p">,</span>
    <span class="n">sequence_like</span><span class="p">,</span>
    <span class="n">smart_deepcopy</span><span class="p">,</span>
    <span class="n">unique_list</span><span class="p">,</span>
    <span class="n">validate_field_name</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">Signature</span>

    <span class="kn">from</span> <span class="nn">pydantic.v1.class_validators</span> <span class="kn">import</span> <span class="n">ValidatorListDict</span>
    <span class="kn">from</span> <span class="nn">pydantic.v1.types</span> <span class="kn">import</span> <span class="n">ModelOrDc</span>
    <span class="kn">from</span> <span class="nn">pydantic.v1.typing</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">AbstractSetIntStr</span><span class="p">,</span>
        <span class="n">AnyClassMethod</span><span class="p">,</span>
        <span class="n">CallableGenerator</span><span class="p">,</span>
        <span class="n">DictAny</span><span class="p">,</span>
        <span class="n">DictStrAny</span><span class="p">,</span>
        <span class="n">MappingIntStrAny</span><span class="p">,</span>
        <span class="n">ReprArgs</span><span class="p">,</span>
        <span class="n">SetStr</span><span class="p">,</span>
        <span class="n">TupleGenerator</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">Model</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">'Model'</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">'BaseModel'</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="s1">'BaseModel'</span><span class="p">,</span> <span class="s1">'create_model'</span><span class="p">,</span> <span class="s1">'validate_model'</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">'_T'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">validate_custom_root_type</span><span class="p">(</span><span class="n">fields</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelField</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">ROOT_KEY</span><span class="si">}</span><span class="s1"> cannot be mixed with other fields'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">generate_hash_function</span><span class="p">(</span><span class="n">frozen</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="k">def</span> <span class="nf">hash_function</span><span class="p">(</span><span class="n">self_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="o">+</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">self_</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">hash_function</span> <span class="k">if</span> <span class="n">frozen</span> <span class="k">else</span> <span class="kc">None</span>


<span class="c1"># If a field is of type `Callable`, its default value should be a function and cannot to ignored.</span>
<span class="n">ANNOTATED_FIELD_UNTOUCHED_TYPES</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">classmethod</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">)</span>
<span class="c1"># When creating a `BaseModel` instance, we bypass all the methods, properties... added to the model</span>
<span class="n">UNTOUCHED_TYPES</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">FunctionType</span><span class="p">,)</span> <span class="o">+</span> <span class="n">ANNOTATED_FIELD_UNTOUCHED_TYPES</span>
<span class="c1"># Note `ModelMetaclass` refers to `BaseModel`, but is also used to *create* `BaseModel`, so we need to add this extra</span>
<span class="c1"># (somewhat hacky) boolean to keep track of whether we've created the `BaseModel` class yet, and therefore whether it's</span>
<span class="c1"># safe to refer to it. If it *hasn't* been created, we assume that the `__new__` call we're in the middle of is for</span>
<span class="c1"># the `BaseModel` class, since that's defined immediately after the metaclass.</span>
<span class="n">_is_base_model_class_defined</span> <span class="o">=</span> <span class="kc">False</span>


<span class="nd">@dataclass_transform</span><span class="p">(</span><span class="n">kw_only_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">field_specifiers</span><span class="o">=</span><span class="p">(</span><span class="n">Field</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">ModelMetaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@no_type_check</span>  <span class="c1"># noqa C901</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># noqa C901</span>
        <span class="n">fields</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelField</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">BaseConfig</span>
        <span class="n">validators</span><span class="p">:</span> <span class="s1">'ValidatorListDict'</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">pre_root_validators</span><span class="p">,</span> <span class="n">post_root_validators</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">private_attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelPrivateAttr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">base_private_attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelPrivateAttr</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">slots</span><span class="p">:</span> <span class="n">SetStr</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__slots__'</span><span class="p">,</span> <span class="p">())</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="p">{</span><span class="n">slots</span><span class="p">}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
        <span class="n">class_vars</span><span class="p">:</span> <span class="n">SetStr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_is_base_model_class_defined</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">base</span> <span class="o">!=</span> <span class="n">BaseModel</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">smart_deepcopy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">__fields__</span><span class="p">))</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">inherit_config</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">__config__</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">validators</span> <span class="o">=</span> <span class="n">inherit_validators</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">__validators__</span><span class="p">,</span> <span class="n">validators</span><span class="p">)</span>
                <span class="n">pre_root_validators</span> <span class="o">+=</span> <span class="n">base</span><span class="o">.</span><span class="n">__pre_root_validators__</span>
                <span class="n">post_root_validators</span> <span class="o">+=</span> <span class="n">base</span><span class="o">.</span><span class="n">__post_root_validators__</span>
                <span class="n">base_private_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="p">)</span>
                <span class="n">class_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">__class_vars__</span><span class="p">)</span>
                <span class="n">hash_func</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="fm">__hash__</span>

        <span class="n">resolve_forward_refs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'__resolve_forward_refs__'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">allowed_config_kwargs</span><span class="p">:</span> <span class="n">SetStr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'__'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'__'</span><span class="p">))</span>  <span class="c1"># skip dunder methods and attributes</span>
        <span class="p">}</span>
        <span class="n">config_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">allowed_config_kwargs</span><span class="p">}</span>
        <span class="n">config_from_namespace</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'Config'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config_kwargs</span> <span class="ow">and</span> <span class="n">config_from_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Specifying config in two places is ambiguous, use either Config attribute or class kwargs'</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">inherit_config</span><span class="p">(</span><span class="n">config_from_namespace</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">config_kwargs</span><span class="p">)</span>

        <span class="n">validators</span> <span class="o">=</span> <span class="n">inherit_validators</span><span class="p">(</span><span class="n">extract_validators</span><span class="p">(</span><span class="n">namespace</span><span class="p">),</span> <span class="n">validators</span><span class="p">)</span>
        <span class="n">vg</span> <span class="o">=</span> <span class="n">ValidatorGroup</span><span class="p">(</span><span class="n">validators</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="n">extra_validators</span> <span class="o">=</span> <span class="n">vg</span><span class="o">.</span><span class="n">get_validators</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extra_validators</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">class_validators</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_validators</span><span class="p">)</span>
                <span class="c1"># re-run prepare to add extra validators</span>
                <span class="n">f</span><span class="o">.</span><span class="n">populate_validators</span><span class="p">()</span>

        <span class="n">prepare_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="n">untouched_types</span> <span class="o">=</span> <span class="n">ANNOTATED_FIELD_UNTOUCHED_TYPES</span>

        <span class="k">def</span> <span class="nf">is_untouched</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">untouched_types</span><span class="p">)</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'cython_function_or_method'</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__module__'</span><span class="p">),</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__qualname__'</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">'pydantic.main'</span><span class="p">,</span> <span class="s1">'BaseModel'</span><span class="p">):</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">resolve_annotations</span><span class="p">(</span><span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__annotations__'</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__module__'</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="c1"># annotation only fields need to come first in fields</span>
            <span class="k">for</span> <span class="n">ann_name</span><span class="p">,</span> <span class="n">ann_type</span> <span class="ow">in</span> <span class="n">annotations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_classvar</span><span class="p">(</span><span class="n">ann_type</span><span class="p">):</span>
                    <span class="n">class_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ann_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">is_finalvar_with_default_val</span><span class="p">(</span><span class="n">ann_type</span><span class="p">,</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ann_name</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)):</span>
                    <span class="n">class_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ann_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">is_valid_field</span><span class="p">(</span><span class="n">ann_name</span><span class="p">):</span>
                    <span class="n">validate_field_name</span><span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">ann_name</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ann_name</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span>
                    <span class="n">allowed_types</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">ann_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_union</span><span class="p">(</span><span class="n">get_origin</span><span class="p">(</span><span class="n">ann_type</span><span class="p">))</span> <span class="k">else</span> <span class="p">(</span><span class="n">ann_type</span><span class="p">,)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">is_untouched</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">ann_type</span> <span class="o">!=</span> <span class="n">PyObject</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">get_origin</span><span class="p">(</span><span class="n">allowed_type</span><span class="p">),</span> <span class="n">Type</span><span class="p">)</span> <span class="k">for</span> <span class="n">allowed_type</span> <span class="ow">in</span> <span class="n">allowed_types</span>
                        <span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">fields</span><span class="p">[</span><span class="n">ann_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelField</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">ann_name</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">annotation</span><span class="o">=</span><span class="n">ann_type</span><span class="p">,</span>
                        <span class="n">class_validators</span><span class="o">=</span><span class="n">vg</span><span class="o">.</span><span class="n">get_validators</span><span class="p">(</span><span class="n">ann_name</span><span class="p">),</span>
                        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">ann_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">namespace</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">underscore_attrs_are_private</span><span class="p">:</span>
                    <span class="n">private_attributes</span><span class="p">[</span><span class="n">ann_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">()</span>

            <span class="n">untouched_types</span> <span class="o">=</span> <span class="n">UNTOUCHED_TYPES</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">keep_untouched</span>
            <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">namespace</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">can_be_changed</span> <span class="o">=</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_vars</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_untouched</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ModelPrivateAttr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_private_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">'Private attributes "</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1">" must not be a valid field name; '</span>
                            <span class="sa">f</span><span class="s1">'Use sunder or dunder names, e. g. "_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1">" or "__</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1">__"'</span>
                        <span class="p">)</span>
                    <span class="n">private_attributes</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">underscore_attrs_are_private</span> <span class="ow">and</span> <span class="n">is_valid_private_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">can_be_changed</span><span class="p">:</span>
                    <span class="n">private_attributes</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">is_valid_field</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">annotations</span> <span class="ow">and</span> <span class="n">can_be_changed</span><span class="p">:</span>
                    <span class="n">validate_field_name</span><span class="p">(</span><span class="n">bases</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                    <span class="n">inferred</span> <span class="o">=</span> <span class="n">ModelField</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">annotation</span><span class="o">=</span><span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">),</span>
                        <span class="n">class_validators</span><span class="o">=</span><span class="n">vg</span><span class="o">.</span><span class="n">get_validators</span><span class="p">(</span><span class="n">var_name</span><span class="p">),</span>
                        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lenient_issubclass</span><span class="p">(</span><span class="n">inferred</span><span class="o">.</span><span class="n">type_</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">type_</span><span class="p">):</span>
                            <span class="n">inferred</span><span class="o">.</span><span class="n">type_</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">type_</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s1">'The type of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1"> differs from the new default value; '</span>
                                <span class="sa">f</span><span class="s1">'if you wish to change the type of this field, please use a type annotation'</span>
                            <span class="p">)</span>
                    <span class="n">fields</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">inferred</span>

        <span class="n">_custom_root_type</span> <span class="o">=</span> <span class="n">ROOT_KEY</span> <span class="ow">in</span> <span class="n">fields</span>
        <span class="k">if</span> <span class="n">_custom_root_type</span><span class="p">:</span>
            <span class="n">validate_custom_root_type</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">vg</span><span class="o">.</span><span class="n">check_for_unused</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">json_encoders</span><span class="p">:</span>
            <span class="n">json_encoder</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">custom_pydantic_encoder</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">json_encoders</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">json_encoder</span> <span class="o">=</span> <span class="n">pydantic_encoder</span>
        <span class="n">pre_rv_new</span><span class="p">,</span> <span class="n">post_rv_new</span> <span class="o">=</span> <span class="n">extract_root_validators</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hash_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hash_func</span> <span class="o">=</span> <span class="n">generate_hash_function</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">frozen</span><span class="p">)</span>

        <span class="n">exclude_from_namespace</span> <span class="o">=</span> <span class="n">fields</span> <span class="o">|</span> <span class="n">private_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">|</span> <span class="p">{</span><span class="s1">'__slots__'</span><span class="p">}</span>
        <span class="n">new_namespace</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'__config__'</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span>
            <span class="s1">'__fields__'</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
            <span class="s1">'__exclude_fields__'</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">exclude</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">}</span>
            <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">'__include_fields__'</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">include</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">}</span>
            <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">'__validators__'</span><span class="p">:</span> <span class="n">vg</span><span class="o">.</span><span class="n">validators</span><span class="p">,</span>
            <span class="s1">'__pre_root_validators__'</span><span class="p">:</span> <span class="n">unique_list</span><span class="p">(</span>
                <span class="n">pre_root_validators</span> <span class="o">+</span> <span class="n">pre_rv_new</span><span class="p">,</span>
                <span class="n">name_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s1">'__post_root_validators__'</span><span class="p">:</span> <span class="n">unique_list</span><span class="p">(</span>
                <span class="n">post_root_validators</span> <span class="o">+</span> <span class="n">post_rv_new</span><span class="p">,</span>
                <span class="n">name_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">skip_on_failure_and_v</span><span class="p">:</span> <span class="n">skip_on_failure_and_v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s1">'__schema_cache__'</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">'__json_encoder__'</span><span class="p">:</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">json_encoder</span><span class="p">),</span>
            <span class="s1">'__custom_root_type__'</span><span class="p">:</span> <span class="n">_custom_root_type</span><span class="p">,</span>
            <span class="s1">'__private_attributes__'</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">base_private_attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">private_attributes</span><span class="p">},</span>
            <span class="s1">'__slots__'</span><span class="p">:</span> <span class="n">slots</span> <span class="o">|</span> <span class="n">private_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="s1">'__hash__'</span><span class="p">:</span> <span class="n">hash_func</span><span class="p">,</span>
            <span class="s1">'__class_vars__'</span><span class="p">:</span> <span class="n">class_vars</span><span class="p">,</span>
            <span class="o">**</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">namespace</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_from_namespace</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">new_namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># set __signature__ attr only for model class, but not for its instances</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">ClassAttribute</span><span class="p">(</span><span class="s1">'__signature__'</span><span class="p">,</span> <span class="n">generate_model_signature</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resolve_forward_refs</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__try_update_forward_refs__</span><span class="p">()</span>

        <span class="c1"># preserve `__set_name__` protocol defined in https://peps.python.org/pep-0487</span>
        <span class="c1"># for attributes not in `new_namespace` (e.g. private attributes)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">namespace</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_namespace</span><span class="p">:</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'__set_name__'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">set_name</span><span class="p">):</span>
                    <span class="n">set_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Avoid calling ABC _abc_subclasscheck unless we're pretty sure.</span>

<span class="sd">        See #3829 and python/cpython#92810</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s1">'__fields__'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__instancecheck__</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>


<span class="n">object_setattr</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span>


<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Representation</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ModelMetaclass</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
        <span class="c1"># populated by the metaclass, defined here to help IDEs only</span>
        <span class="n">__fields__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelField</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">__include_fields__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">__exclude_fields__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">__validators__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AnyCallable</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">__pre_root_validators__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AnyCallable</span><span class="p">]]</span>
        <span class="n">__post_root_validators__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">AnyCallable</span><span class="p">]]]</span>
        <span class="n">__config__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">BaseConfig</span>
        <span class="n">__json_encoder__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="n">__schema_cache__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="s1">'DictAny'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">__custom_root_type__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">__signature__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="s1">'Signature'</span><span class="p">]</span>
        <span class="n">__private_attributes__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelPrivateAttr</span><span class="p">]]</span>
        <span class="n">__class_vars__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">SetStr</span><span class="p">]</span>
        <span class="n">__fields_set__</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">SetStr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">Config</span> <span class="o">=</span> <span class="n">BaseConfig</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'__dict__'</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">)</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">''</span>  <span class="c1"># Null out the Representation docstring</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">__pydantic_self__</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Create a new model by parsing and validating input data from keyword arguments.</span>

<span class="sd">        Raises ValidationError if the input data cannot be parsed to form a valid model.</span>
<span class="sd">        """</span>
        <span class="c1"># Uses something other than `self` the first arg to allow "self" as a settable attribute</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">,</span> <span class="n">validation_error</span> <span class="o">=</span> <span class="n">validate_model</span><span class="p">(</span><span class="n">__pydantic_self__</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">validation_error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">object_setattr</span><span class="p">(</span><span class="n">__pydantic_self__</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">'Model values must be a dict; you may not have returned a dictionary from a root validator'</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">__pydantic_self__</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">)</span>
        <span class="n">__pydantic_self__</span><span class="o">.</span><span class="n">_init_private_attributes</span><span class="p">()</span>

    <span class="nd">@no_type_check</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="c1"># noqa: C901 (ignore complexity)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">DUNDER_ATTRIBUTES</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Extra</span><span class="o">.</span><span class="n">allow</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">" object has no field "</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">"'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">allow_mutation</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">" is immutable and does not support item assignment'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">" object "</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">" field is final and does not support reassignment'</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">validate_assignment</span><span class="p">:</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">validator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pre_root_validators__</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_values</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">([</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

            <span class="n">known_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">known_field</span><span class="p">:</span>
                <span class="c1"># We want to</span>
                <span class="c1"># - make sure validators are called without the current value for this field inside `values`</span>
                <span class="c1"># - keep other values (e.g. submodels) untouched (using `BaseModel.dict()` will change them into dicts)</span>
                <span class="c1"># - keep the order of the fields</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">known_field</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">allow_mutation</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">known_field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">" has allow_mutation set to False and cannot be assigned'</span><span class="p">)</span>
                <span class="n">dict_without_original_value</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">name</span><span class="p">}</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">error_</span> <span class="o">=</span> <span class="n">known_field</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dict_without_original_value</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">error_</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">([</span><span class="n">error_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">skip_on_failure</span><span class="p">,</span> <span class="n">validator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__post_root_validators__</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">skip_on_failure</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_values</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

            <span class="c1"># update the whole __dict__ as other values than just `value`</span>
            <span class="c1"># may be changed (e.g. with `root_validator`)</span>
            <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__fields_set__</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'DictAny'</span><span class="p">:</span>
        <span class="n">private_attrs</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'__dict__'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span>
            <span class="s1">'__fields_set__'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields_set__</span><span class="p">,</span>
            <span class="s1">'__private_attribute_values__'</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">private_attrs</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="s1">'DictAny'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s1">'__dict__'</span><span class="p">])</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s1">'__fields_set__'</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'__private_attribute_values__'</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_private_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">private_attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">private_attr</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'DictStrAny'</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Generate a dictionary representation of the model, optionally specifying which fields to include or exclude.</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">skip_defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.dict(): "skip_defaults" is deprecated and replaced by "exclude_unset"'</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">exclude_unset</span> <span class="o">=</span> <span class="n">skip_defaults</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span>
                <span class="n">to_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span>
                <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_defaults</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">encoder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">models_as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Generate a JSON representation of the model, `include` and `exclude` arguments as per `dict()`.</span>

<span class="sd">        `encoder` is an optional function to supply as `default` to json.dumps(), other arguments as per `json.dumps()`.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">skip_defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.json(): "skip_defaults" is deprecated and replaced by "exclude_unset"'</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">exclude_unset</span> <span class="o">=</span> <span class="n">skip_defaults</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="n">encoder</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__json_encoder__</span><span class="p">)</span>

        <span class="c1"># We don't directly call `self.dict()`, which does exactly this with `to_dict=True`</span>
        <span class="c1"># because we want to be able to keep raw `BaseModel` instances and not as `dict`.</span>
        <span class="c1"># This allows users to write custom JSON encoders for given `BaseModel` classes.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span>
                <span class="n">to_dict</span><span class="o">=</span><span class="n">models_as_dict</span><span class="p">,</span>
                <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span>
                <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__custom_root_type__</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ROOT_KEY</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_enforce_dict_if_root</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__custom_root_type__</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="n">ROOT_KEY</span><span class="p">})</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="n">ROOT_KEY</span><span class="p">})</span>
            <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="p">[</span><span class="n">ROOT_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="n">MAPPING_LIKE_SHAPES</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">ROOT_KEY</span><span class="p">:</span> <span class="n">obj</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_obj</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_enforce_dict_if_root</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">exc</span> <span class="o">=</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> expected dict not </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">([</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">)],</span> <span class="bp">cls</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">obj</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_raw</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">StrBytes</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'utf8'</span><span class="p">,</span>
        <span class="n">proto</span><span class="p">:</span> <span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">load_str_bytes</span><span class="p">(</span>
                <span class="n">b</span><span class="p">,</span>
                <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span>
                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                <span class="n">allow_pickle</span><span class="o">=</span><span class="n">allow_pickle</span><span class="p">,</span>
                <span class="n">json_loads</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_loads</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">([</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">)],</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'utf8'</span><span class="p">,</span>
        <span class="n">proto</span><span class="p">:</span> <span class="n">Protocol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allow_pickle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">,</span>
            <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">allow_pickle</span><span class="o">=</span><span class="n">allow_pickle</span><span class="p">,</span>
            <span class="n">json_loads</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_loads</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_orm</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">orm_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="s1">'You must have the config attribute orm_mode=True to use from_orm'</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">ROOT_KEY</span><span class="p">:</span> <span class="n">obj</span><span class="p">}</span> <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__custom_root_type__</span> <span class="k">else</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_decompose_class</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">,</span> <span class="n">validation_error</span> <span class="o">=</span> <span class="n">validate_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">validation_error</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">_init_private_attributes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">_fields_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'SetStr'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Creates a new model setting __dict__ and __fields_set__ from trusted or pre-validated data.</span>
<span class="sd">        Default values are respected, but no other validation is performed.</span>
<span class="sd">        Behaves as if `Config.extra = 'allow'` was set since it adds all passed values</span>
<span class="sd">        """</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">fields_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">alt_alias</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">alias</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">fields_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">fields_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="n">fields_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
        <span class="n">fields_values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">fields_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_fields_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">,</span> <span class="n">_fields_set</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">_init_private_attributes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">_copy_and_set_values</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">'Model'</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="s1">'DictStrAny'</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">:</span> <span class="s1">'SetStr'</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
            <span class="c1"># chances of having empty dict here are quite low for using smart_deepcopy</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__dict__'</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">'__fields_set__'</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">object_setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s1">'Model'</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'DictStrAny'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Duplicate a model, optionally choose which fields to include, exclude and change.</span>

<span class="sd">        :param include: fields to include in new model</span>
<span class="sd">        :param exclude: fields to exclude from new model, as with values this takes precedence over include</span>
<span class="sd">        :param update: values to change/add in the new model. Note: the data is not validated before creating</span>
<span class="sd">            the new model: you should trust this data</span>
<span class="sd">        :param deep: set to `True` to make a deep copy of the model</span>
<span class="sd">        :return: new model instance</span>
<span class="sd">        """</span>

        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">to_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="o">**</span><span class="p">(</span><span class="n">update</span> <span class="ow">or</span> <span class="p">{}),</span>
        <span class="p">)</span>

        <span class="c1"># new `__fields_set__` can have unset optional fields with a set value in `update` kwarg</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">fields_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields_set__</span> <span class="o">|</span> <span class="n">update</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__fields_set__</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_and_set_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ref_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">default_ref_template</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'DictStrAny'</span><span class="p">:</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__schema_cache__</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">by_alias</span><span class="p">,</span> <span class="n">ref_template</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">model_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span> <span class="n">ref_template</span><span class="o">=</span><span class="n">ref_template</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__schema_cache__</span><span class="p">[(</span><span class="n">by_alias</span><span class="p">,</span> <span class="n">ref_template</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">schema_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ref_template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">default_ref_template</span><span class="p">,</span> <span class="o">**</span><span class="n">dumps_kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pydantic.v1.json</span> <span class="kn">import</span> <span class="n">pydantic_encoder</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_dumps</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span> <span class="n">ref_template</span><span class="o">=</span><span class="n">ref_template</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">pydantic_encoder</span><span class="p">,</span> <span class="o">**</span><span class="n">dumps_kwargs</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_validators__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'CallableGenerator'</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Model'</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="n">copy_on_model_validation</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">copy_on_model_validation</span>
            <span class="c1"># whether to deep or shallow copy the model on validation, None means do not copy</span>
            <span class="n">deep_copy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">copy_on_model_validation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">'deep'</span><span class="p">,</span> <span class="s1">'shallow'</span><span class="p">,</span> <span class="s1">'none'</span><span class="p">}:</span>
                <span class="c1"># Warn about deprecated behavior</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">"`copy_on_model_validation` should be a string: 'deep', 'shallow' or 'none'"</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">copy_on_model_validation</span><span class="p">:</span>
                    <span class="n">deep_copy</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">copy_on_model_validation</span> <span class="o">==</span> <span class="s1">'shallow'</span><span class="p">:</span>
                <span class="c1"># shallow copy</span>
                <span class="n">deep_copy</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">copy_on_model_validation</span> <span class="o">==</span> <span class="s1">'deep'</span><span class="p">:</span>
                <span class="c1"># deep copy</span>
                <span class="n">deep_copy</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">deep_copy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">_copy_and_set_values</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">__fields_set__</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep_copy</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_enforce_dict_if_root</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">orm_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_orm</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value_as_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DictError</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">value_as_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_decompose_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GetterDict</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GetterDict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">getter_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@no_type_check</span>
    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">to_dict</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]],</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]],</span>
        <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">to_dict</span><span class="p">:</span>
                <span class="n">v_dict</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span>
                    <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                    <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                    <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                    <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                    <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">ROOT_KEY</span> <span class="ow">in</span> <span class="n">v_dict</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">v_dict</span><span class="p">[</span><span class="n">ROOT_KEY</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">v_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

        <span class="n">value_exclude</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">value_include</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">k_</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span>
                    <span class="n">v_</span><span class="p">,</span>
                    <span class="n">to_dict</span><span class="o">=</span><span class="n">to_dict</span><span class="p">,</span>
                    <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                    <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                    <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                    <span class="n">include</span><span class="o">=</span><span class="n">value_include</span> <span class="ow">and</span> <span class="n">value_include</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">k_</span><span class="p">),</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="n">value_exclude</span> <span class="ow">and</span> <span class="n">value_exclude</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">k_</span><span class="p">),</span>
                    <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">k_</span><span class="p">,</span> <span class="n">v_</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_exclude</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value_exclude</span><span class="o">.</span><span class="n">is_excluded</span><span class="p">(</span><span class="n">k_</span><span class="p">))</span>
                <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_include</span> <span class="ow">or</span> <span class="n">value_include</span><span class="o">.</span><span class="n">is_included</span><span class="p">(</span><span class="n">k_</span><span class="p">))</span>
            <span class="p">}</span>

        <span class="k">elif</span> <span class="n">sequence_like</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">seq_args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span>
                    <span class="n">v_</span><span class="p">,</span>
                    <span class="n">to_dict</span><span class="o">=</span><span class="n">to_dict</span><span class="p">,</span>
                    <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                    <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                    <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                    <span class="n">include</span><span class="o">=</span><span class="n">value_include</span> <span class="ow">and</span> <span class="n">value_include</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="n">value_exclude</span> <span class="ow">and</span> <span class="n">value_exclude</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_exclude</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value_exclude</span><span class="o">.</span><span class="n">is_excluded</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_include</span> <span class="ow">or</span> <span class="n">value_include</span><span class="o">.</span><span class="n">is_included</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">seq_args</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_namedtuple</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">seq_args</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Enum</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">Config</span><span class="p">,</span> <span class="s1">'use_enum_values'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__try_update_forward_refs__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">localns</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Same as update_forward_refs but will not raise exception</span>
<span class="sd">        when forward references are not defined.</span>
<span class="sd">        """</span>
        <span class="n">update_model_forward_refs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_encoders</span><span class="p">,</span> <span class="n">localns</span><span class="p">,</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update_forward_refs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">localns</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Try to update ForwardRefs on fields based on this Model, globalns and localns.</span>
<span class="sd">        """</span>
        <span class="n">update_model_forward_refs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__config__</span><span class="o">.</span><span class="n">json_encoders</span><span class="p">,</span> <span class="n">localns</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'TupleGenerator'</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        so `dict(model)` works</span>
<span class="sd">        """</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_iter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">to_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">'AbstractSetIntStr'</span><span class="p">,</span> <span class="s1">'MappingIntStrAny'</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'TupleGenerator'</span><span class="p">:</span>
        <span class="c1"># Merge field set excludes with explicit exclude parameter with explicit overriding field set options.</span>
        <span class="c1"># The extra "is not None" guards are not logically necessary but optimizes performance for the simple case.</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exclude_fields__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__exclude_fields__</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__include_fields__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__include_fields__</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">intersect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">allowed_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_keys</span><span class="p">(</span>
            <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed_keys</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">to_dict</span> <span class="ow">or</span> <span class="n">by_alias</span> <span class="ow">or</span> <span class="n">exclude_unset</span> <span class="ow">or</span> <span class="n">exclude_defaults</span> <span class="ow">or</span> <span class="n">exclude_none</span><span class="p">):</span>
            <span class="c1"># huge boost for plain _iter()</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">value_exclude</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">value_include</span> <span class="o">=</span> <span class="n">ValueItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">field_key</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">allowed_keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">field_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_keys</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">exclude_none</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">exclude_defaults</span><span class="p">:</span>
                <span class="n">model_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model_field</span><span class="p">,</span> <span class="s1">'required'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model_field</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">,</span> <span class="n">_missing</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">by_alias</span> <span class="ow">and</span> <span class="n">field_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="p">:</span>
                <span class="n">dict_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="p">[</span><span class="n">field_key</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict_key</span> <span class="o">=</span> <span class="n">field_key</span>

            <span class="k">if</span> <span class="n">to_dict</span> <span class="ow">or</span> <span class="n">value_include</span> <span class="ow">or</span> <span class="n">value_exclude</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span>
                    <span class="n">v</span><span class="p">,</span>
                    <span class="n">to_dict</span><span class="o">=</span><span class="n">to_dict</span><span class="p">,</span>
                    <span class="n">by_alias</span><span class="o">=</span><span class="n">by_alias</span><span class="p">,</span>
                    <span class="n">include</span><span class="o">=</span><span class="n">value_include</span> <span class="ow">and</span> <span class="n">value_include</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">field_key</span><span class="p">),</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="n">value_exclude</span> <span class="ow">and</span> <span class="n">value_exclude</span><span class="o">.</span><span class="n">for_element</span><span class="p">(</span><span class="n">field_key</span><span class="p">),</span>
                    <span class="n">exclude_unset</span><span class="o">=</span><span class="n">exclude_unset</span><span class="p">,</span>
                    <span class="n">exclude_defaults</span><span class="o">=</span><span class="n">exclude_defaults</span><span class="p">,</span>
                    <span class="n">exclude_none</span><span class="o">=</span><span class="n">exclude_none</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">yield</span> <span class="n">dict_key</span><span class="p">,</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_calculate_keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'MappingIntStrAny'</span><span class="p">],</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'MappingIntStrAny'</span><span class="p">],</span>
        <span class="n">exclude_unset</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'DictStrAny'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AbstractSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exclude_unset</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">keys</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exclude_unset</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields_set__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">&amp;=</span> <span class="n">include</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">-=</span> <span class="n">update</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">-=</span> <span class="p">{</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exclude</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ValueItems</span><span class="o">.</span><span class="n">is_true</span><span class="p">(</span><span class="n">v</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">keys</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__repr_args__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'ReprArgs'</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DUNDER_ATTRIBUTES</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">field_info</span><span class="o">.</span><span class="n">repr</span><span class="p">)</span>
        <span class="p">]</span>


<span class="n">_is_base_model_class_defined</span> <span class="o">=</span> <span class="kc">True</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span>
    <span class="n">__model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">__config__</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__base__</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">__validators__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">'AnyClassMethod'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__cls_kwargs__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">field_definitions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'BaseModel'</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span>
    <span class="n">__model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">__config__</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__base__</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="o">...</span><span class="p">]],</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">__validators__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">'AnyClassMethod'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__cls_kwargs__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">field_definitions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span>
    <span class="n">__model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">__config__</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__base__</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">__validators__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">'AnyClassMethod'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">__cls_kwargs__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="vm">__slots__</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">field_definitions</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Dynamically create a model.</span>
<span class="sd">    :param __model_name: name of the created model</span>
<span class="sd">    :param __config__: config class to use for the new model</span>
<span class="sd">    :param __base__: base class for the new model to inherit from</span>
<span class="sd">    :param __module__: module of the created model</span>
<span class="sd">    :param __validators__: a dict of method names and @validator class methods</span>
<span class="sd">    :param __cls_kwargs__: a dict for class creation</span>
<span class="sd">    :param __slots__: Deprecated, `__slots__` should not be passed to `create_model`</span>
<span class="sd">    :param field_definitions: fields of the model (or extra fields if a base is supplied)</span>
<span class="sd">        in the format `&lt;name&gt;=(&lt;type&gt;, &lt;default default&gt;)` or `&lt;name&gt;=&lt;default value&gt;, e.g.</span>
<span class="sd">        `foobar=(str, ...)` or `foobar=123`, or, for complex use-cases, in the format</span>
<span class="sd">        `&lt;name&gt;=&lt;Field&gt;` or `&lt;name&gt;=(&lt;type&gt;, &lt;FieldInfo&gt;)`, e.g.</span>
<span class="sd">        `foo=Field(datetime, default_factory=datetime.utcnow, alias='bar')` or</span>
<span class="sd">        `foo=(str, FieldInfo(title='Foo'))`</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="vm">__slots__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># __slots__ will be ignored from here on</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">'__slots__ should not be passed to create_model'</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">__base__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__config__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="s1">'to avoid confusion __config__ and __base__ cannot be used together'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__base__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">__base__</span> <span class="o">=</span> <span class="p">(</span><span class="n">__base__</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">__base__</span> <span class="o">=</span> <span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">Type</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">],</span> <span class="n">BaseModel</span><span class="p">),)</span>

    <span class="n">__cls_kwargs__</span> <span class="o">=</span> <span class="n">__cls_kwargs__</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">f_name</span><span class="p">,</span> <span class="n">f_def</span> <span class="ow">in</span> <span class="n">field_definitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_field</span><span class="p">(</span><span class="n">f_name</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">'fields may not start with an underscore, ignoring "</span><span class="si">{</span><span class="n">f_name</span><span class="si">}</span><span class="s1">"'</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_def</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f_annotation</span><span class="p">,</span> <span class="n">f_value</span> <span class="o">=</span> <span class="n">f_def</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span>
                    <span class="s1">'field definitions should either be a tuple of (&lt;type&gt;, &lt;default&gt;) or just a '</span>
                    <span class="s1">'default value, unfortunately this means tuples as '</span>
                    <span class="s1">'default values are not allowed'</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_annotation</span><span class="p">,</span> <span class="n">f_value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">f_def</span>

        <span class="k">if</span> <span class="n">f_annotation</span><span class="p">:</span>
            <span class="n">annotations</span><span class="p">[</span><span class="n">f_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_annotation</span>
        <span class="n">fields</span><span class="p">[</span><span class="n">f_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_value</span>

    <span class="n">namespace</span><span class="p">:</span> <span class="s1">'DictStrAny'</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'__annotations__'</span><span class="p">:</span> <span class="n">annotations</span><span class="p">,</span> <span class="s1">'__module__'</span><span class="p">:</span> <span class="vm">__module__</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">__validators__</span><span class="p">:</span>
        <span class="n">namespace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">__validators__</span><span class="p">)</span>
    <span class="n">namespace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__config__</span><span class="p">:</span>
        <span class="n">namespace</span><span class="p">[</span><span class="s1">'Config'</span><span class="p">]</span> <span class="o">=</span> <span class="n">inherit_config</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="n">BaseConfig</span><span class="p">)</span>
    <span class="n">resolved_bases</span> <span class="o">=</span> <span class="n">resolve_bases</span><span class="p">(</span><span class="n">__base__</span><span class="p">)</span>
    <span class="n">meta</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">kwds</span> <span class="o">=</span> <span class="n">prepare_class</span><span class="p">(</span><span class="n">__model_name</span><span class="p">,</span> <span class="n">resolved_bases</span><span class="p">,</span> <span class="n">kwds</span><span class="o">=</span><span class="n">__cls_kwargs__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resolved_bases</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">__base__</span><span class="p">:</span>
        <span class="n">ns</span><span class="p">[</span><span class="s1">'__orig_bases__'</span><span class="p">]</span> <span class="o">=</span> <span class="n">__base__</span>
    <span class="n">namespace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">meta</span><span class="p">(</span><span class="n">__model_name</span><span class="p">,</span> <span class="n">resolved_bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">_missing</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">validate_model</span><span class="p">(</span>  <span class="c1"># noqa: C901 (ignore complexity)</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">input_data</span><span class="p">:</span> <span class="s1">'DictStrAny'</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="s1">'ModelOrDc'</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s1">'DictStrAny'</span><span class="p">,</span> <span class="s1">'SetStr'</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValidationError</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    validate data against a model.</span>
<span class="sd">    """</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># input_data names, possibly alias</span>
    <span class="n">names_used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># field names, never aliases</span>
    <span class="n">fields_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">__config__</span>
    <span class="n">check_extra</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Extra</span><span class="o">.</span><span class="n">ignore</span>
    <span class="n">cls_</span> <span class="o">=</span> <span class="bp">cls</span> <span class="ow">or</span> <span class="n">model</span>

    <span class="k">for</span> <span class="n">validator</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">__pre_root_validators__</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_data</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">cls_</span><span class="p">,</span> <span class="n">input_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{},</span> <span class="nb">set</span><span class="p">(),</span> <span class="n">ValidationError</span><span class="p">([</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">)],</span> <span class="n">cls_</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="n">_missing</span><span class="p">)</span>
        <span class="n">using_name</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">_missing</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">allow_population_by_field_name</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">alt_alias</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">_missing</span><span class="p">)</span>
            <span class="n">using_name</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">_missing</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">MissingError</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">validate_all</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">validate_always</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_extra</span><span class="p">:</span>
                <span class="n">names_used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">using_name</span> <span class="k">else</span> <span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">)</span>

        <span class="n">v_</span><span class="p">,</span> <span class="n">errors_</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">cls_</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors_</span><span class="p">,</span> <span class="n">ErrorWrapper</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errors_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors_</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">errors_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_</span>

    <span class="k">if</span> <span class="n">check_extra</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">GetterDict</span><span class="p">):</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">extra_keys</span><span class="p">()</span> <span class="o">-</span> <span class="n">names_used</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="n">names_used</span>
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">fields_set</span> <span class="o">|=</span> <span class="n">extra</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">extra</span> <span class="ow">is</span> <span class="n">Extra</span><span class="o">.</span><span class="n">allow</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extra</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">ExtraError</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="n">f</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">skip_on_failure</span><span class="p">,</span> <span class="n">validator</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">__post_root_validators__</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">skip_on_failure</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">cls_</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErrorWrapper</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ROOT_KEY</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">cls_</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">,</span> <span class="n">fields_set</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>
</article>
</div>
</div>
<footer class="bd-footer-content">
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>
<footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
<div class="footer-items__start">
<div class="footer-item">
<p class="copyright">
    
      Â© Copyright 2023, LangChain Inc.
      <br/>
</p>
</div>
</div>
</div>
</footer>
</body>
</html>